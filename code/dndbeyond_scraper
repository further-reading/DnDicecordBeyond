from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.common.exceptions import WebDriverException
import os


class DnDBeyond:
    driver_path = '{}/drivers/chromedriver'.format

    def scrape(self, url):
        output = {}
        cwd = os.getcwd()
        try:
            driver = webdriver.Chrome(self.driver_path(cwd))
        except WebDriverException:
            driver = webdriver.Chrome(self.driver_path(cwd + '/code'))
        # make window long to avoid mobile view
        driver.set_window_size(width=2000, height=1000)
        driver.get(url)

        # wait for content to load
        WebDriverWait(driver, 10).until(
                EC.presence_of_element_located((By.CSS_SELECTOR, '.ct-character-tidbits__name'))
            )

        name = driver.find_element_by_css_selector('.ct-character-tidbits__name')
        output['name'] = name.text
        stats = driver.find_elements_by_css_selector('.ct-ability-summary')

        driver.close()
        return output
